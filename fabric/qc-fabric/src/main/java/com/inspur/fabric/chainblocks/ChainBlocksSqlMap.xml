<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ChainBlocksDomain">
	<select id="getChainBlocks" parameterType="String" resultType="map">
		SELECT
			ID,
			CHANNEL_NAME,
			BLOCK_NUM,
			CURRENT_HASH,
			PRE_HASH,
			TX_COUNT,
			DATE_FORMAT(TIME, '%Y-%m-%d %H:%i:%s') AS TIME
		FROM CHAIN_BLOCKS
		WHERE ID=#{value}
	</select>
	<select id="getChainBlockHight" parameterType="String" resultType="map">
		SELECT
			COUNT(ID) VAL
		FROM trace.CHAIN_BLOCKS where CHANNEL_NAME=#{value}
	</select>
	
	<insert id="insertChainBlocks" parameterType="map">
		INSERT INTO chain_blocks(
			ID,
			CHANNEL_NAME,
			BLOCK_NUM,
			CURRENT_HASH,
			PRE_HASH,
			TX_COUNT,
			TIME
		) VALUES (
			#{ID,jdbcType=VARCHAR},
			#{CHANNEL_NAME,jdbcType=VARCHAR},
			#{BLOCK_NUM,jdbcType=VARCHAR},
			#{CURRENT_HASH,jdbcType=VARCHAR},
			#{PRE_HASH,jdbcType=VARCHAR},
			#{TX_COUNT,jdbcType=VARCHAR},
			#{TIME,jdbcType=VARCHAR}
		)
	</insert>

	<update id="updateChainBlocks" parameterType="map">
		UPDATE chain_blocks SET
			ID = #{ID,jdbcType=VARCHAR},
			CHANNEL_NAME = #{CHANNEL_NAME,jdbcType=VARCHAR},
			BLOCK_NUM = #{BLOCK_NUM,jdbcType=VARCHAR},
			CURRENT_HASH = #{CURRENT_HASH,jdbcType=VARCHAR},
			PRE_HASH = #{PRE_HASH,jdbcType=VARCHAR},
			TX_COUNT = #{TX_COUNT,jdbcType=VARCHAR},
			TIME = #{TIME,jdbcType=VARCHAR}
		WHERE ID=#{ID}
	</update>
	
	<delete id="deleteChainBlocks" parameterType="String">
		DELETE FROM chain_blocks WHERE ID=#{value}
	</delete>

	<select id="getAllChainBlocksPage" parameterType="map" resultType="map">
		SELECT
			ID,
			CHANNEL_NAME,
			BLOCK_NUM,
			CURRENT_HASH,
			PRE_HASH,
			TX_COUNT,
			DATE_FORMAT(TIME, '%Y-%m-%d %H:%i:%s') AS TIME
		FROM chain_blocks
		<where>
			<if test="idSearch != null and idSearch != ''">
				AND ID = #{idSearch}
			</if>
			<if test="channel_nameSearch != null and channel_nameSearch != ''">
				AND CHANNEL_NAME = #{channel_nameSearch}
			</if>
			<if test="block_numSearch != null and block_numSearch != ''">
				AND BLOCK_NUM = #{block_numSearch}
			</if>
			<if test="current_hashSearch != null and current_hashSearch != ''">
				AND CURRENT_HASH = #{current_hashSearch}
			</if>
			<if test="pre_hashSearch != null and pre_hashSearch != ''">
				AND PRE_HASH = #{pre_hashSearch}
			</if>
			<if test="tx_countSearch != null and tx_countSearch != ''">
				AND TX_COUNT = #{tx_countSearch}
			</if>
			<if test="timeSearch != null and timeSearch != ''">
				AND TIME = #{timeSearch}
			</if>
		</where>
		ORDER BY TIME DESC
	</select>
</mapper>
