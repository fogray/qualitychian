<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="FabricChannelDomain">
	<select id="getFabricChannelMap" resultType="map" parameterType="map">
		SELECT
			CHANNEL_ID,
			CHANNEL_NAME,
			CHANNEL_DESC,
			DATE_FORMAT(UPDATE_TIME, '%Y-%m-%d %H:%i:%s') AS UPDATE_TIME
		FROM CHAIN_CHANNEL
		<where>
			<if test="CHANNEL_ID !='' and CHANNEL_ID !=null">
			AND CHANNEL_ID = #{CHANNEL_ID}
			</if>
			<if test=" CHANNEL_NAME!='' and CHANNEL_NAME !=null">
			AND CHANNEL_NAME = #{CHANNEL_NAME}
			</if>
			<if test=" CHANNEL_DESC!='' and  CHANNEL_DESC!=null">
			AND CHANNEL_DESC = #{CHANNEL_DESC}
			</if>
		</where>
	</select>
	<select id="getFabricChannel" parameterType="String" resultType="map">
		SELECT
			CHANNEL_ID,
			CHANNEL_NAME,
			CHANNEL_DESC,
			DATE_FORMAT(UPDATE_TIME, '%Y-%m-%d %H:%i:%s') AS UPDATE_TIME
		FROM CHAIN_CHANNEL
		WHERE CHANNEL_NAME=#{value}
	</select>
	
	<insert id="insertFabricChannel" parameterType="map">
		INSERT INTO CHAIN_CHANNEL(
			CHANNEL_ID,
			CHANNEL_NAME,
			CHANNEL_DESC,
			UPDATE_TIME
		) VALUES (
			#{CHANNEL_ID,jdbcType=VARCHAR},
			#{CHANNEL_NAME,jdbcType=VARCHAR},
			#{CHANNEL_DESC,jdbcType=VARCHAR},
			#{UPDATE_TIME,jdbcType=TIMESTAMP}
		)
	</insert>

	<update id="updateFabricChannel" parameterType="map">
		UPDATE CHAIN_CHANNEL SET CHANNEL_DESC = #{CHANNEL_DESC,jdbcType=VARCHAR},UPDATE_TIME=#{UPDATE_TIME,jdbcType=TIMESTAMP}
		WHERE CHANNEL_NAME=#{CHANNEL_NAME}
	</update>
	
	<delete id="deleteFabricChannel" parameterType="String">
		DELETE FROM CHAIN_CHANNEL WHERE CHANNEL_NAME=#{value}
	</delete>

	<select id="getAllFabricChannel" resultType="map" parameterType="map">
		SELECT
			CHANNEL_ID,
			CHANNEL_NAME,
			CHANNEL_DESC,
			DATE_FORMAT(UPDATE_TIME, '%Y-%m-%d %H:%i:%s') AS UPDATE_TIME,
			CHANNEL_STATUS
		FROM CHAIN_CHANNEL
		<where>
			<if test="CHANNEL_ID !='' and CHANNEL_ID !=null">
			AND CHANNEL_ID = #{CHANNEL_ID}
			</if>
			<if test=" CHANNEL_NAME!='' and CHANNEL_NAME !=null">
			AND CHANNEL_NAME like concat(concat('%', #{CHANNEL_NAME}),'%')
			</if>
			<if test=" CHANNEL_DESC!='' and  CHANNEL_DESC!=null">
			AND CHANNEL_DESC like concat(concat('%', #{CHANNEL_DESC}),'%')
			</if>
		</where>
		ORDER BY UPDATE_TIME DESC
	</select>
	
	<select id="getValidChannels" resultType="map">
		SELECT
			CHANNEL_NAME
		FROM
			chain_channel
		WHERE
			CHANNEL_STATUS='1';
	</select>
</mapper>
